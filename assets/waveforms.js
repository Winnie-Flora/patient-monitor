// Waveform data configurations
const waveformData = {
  ecg: {
    normal_sinus_rhythm: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0,
      0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    sinus_bradycardia: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    sinus_tachycardia: [
      0, 0.1, 0.2, 0.1, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, -0.1, -0.2,
      -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    atrial_fibrillation: [
      0, 0.1, -0.1, 0.2, -0.2, 0.3, -0.3, 0.1, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0.1, -0.2, 0.2, -0.1, 0.3, -0.3,
      0.1, -0.1, 0.2, 0, 0.8, 1, 0.8, 0, -0.2, -0.1,
    ],
    atrial_flutter: [
      0, 0.2, 0.4, 0.2, 0, 0.2, 0.4, 0.2, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.2, 0.4, 0.2, 0,
      0.2, 0.4, 0.2, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    supraventricular_tachycardia: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0,
      0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    premature_atrial_contraction: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.2, 0.4, 0.2, 0, -0.2,
      -0.4, -0.2, 0, 1, 1.2, 1, 0, -0.3, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1,
      0.8, 0, -0.2, -0.1, 0,
    ],
    wandering_atrial_pacemaker: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.2, 0.3, 0.2, 0, 0, 0, -0.2,
      -0.3, -0.2, 0, 0.9, 1.1, 0.9, 0, -0.3, -0.2, 0, 0, 0.15, 0.25, 0.15, 0, 0, 0, -0.15, -0.25, -0.15, 0, 0.85, 1.05,
      0.85, 0, -0.25, -0.15, 0,
    ],
    junctional_rhythm: [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 1, 0.8, 0, -0.2,
      -0.1, 0,
    ],
    accelerated_junctional_rhythm: [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.8, 1, 0.8, 0, -0.2, -0.1,
      0,
    ],
    premature_junctional_contraction: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,
      1.2, 1, 0, -0.3, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1,
      0,
    ],
    sinus_arrest: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ],
    ventricular_tachycardia: [
      0, -0.2, -0.4, -0.2, 0, 0.4, 0.8, 0.4, 0, -0.4, -0.8, -0.4, 0, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.2, 0, 0.4, 0.8,
      0.4, 0, -0.4, -0.8, -0.4, 0, 0.2, 0.4, 0.2,
    ],
    ventricular_fibrillation: [
      0.2, -0.3, 0.5, -0.2, 0.4, -0.5, 0.3, -0.4, 0.2, -0.3, 0.4, -0.2, 0.5, -0.3, 0.2, -0.4, 0.3, -0.5, 0.4, -0.2, 0.3,
      -0.4, 0.5, -0.3, 0.2, -0.4, 0.3, -0.2, 0.4, -0.5, 0.2, -0.3, 0.5, -0.2, 0.4, -0.5, 0.3, -0.4, 0.2, -0.3,
    ],
    premature_ventricular_contraction: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, -0.4, -0.8, -0.4, 0, 0.8,
      1.6, 0.8, 0, -0.8, -1.6, -0.8, 0, 0.4, 0.8, 0.4, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1,
      0.8, 0, -0.2, -0.1, 0,
    ],
    ventricular_escape_rhythm: [
      0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.4, -0.8, -0.4, 0, 0.8, 1.6, 0.8, 0, -0.8, -1.6,
      -0.8, 0, 0.4, 0.8, 0.4, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
    ],
    asystole: Array(60).fill(0),
    first_degree_av_block: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0,
      0, 0, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    second_degree_av_block_type_i: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0,
      0, -0.1, -0.2, -0.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0,
      -0.2, -0.1, 0,
    ],
    second_degree_av_block_type_ii: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0,
      0, -0.1, -0.2, -0.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0,
      -0.2, -0.1, 0,
    ],
    third_degree_av_block: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
      0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0, 0, 0, 0, 0, 0, 0,
    ],
    right_bundle_branch_block: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0.2, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1,
      0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0.2, 0, -0.2, -0.1, 0,
    ],
    left_bundle_branch_block: [
      0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.4, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
      0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.4, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    left_anterior_fascicular_block: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.1, 0.2, 0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0,
      -0.1, -0.2, -0.1, 0, 0.1, 0.2, 0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    left_posterior_fascicular_block: [
      0, -0.1, -0.2, -0.1, 0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, -0.1, -0.2, -0.1,
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    nonspecific_intraventricular_conduction_delay: [
      0, 0.1, 0.2, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0, 0, 0.1,
      0.2, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0,
    ],
    wolff_parkinson_white_syndrome: [
      0, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.2, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.2, 0,
      0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    long_qt_syndrome: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.6, 0.4, 0.2, 0, -0.2, -0.1, 0, 0, 0.1, 0.2,
      0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.6, 0.4, 0.2, 0, -0.2, -0.1, 0,
    ],
    short_qt_syndrome: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1,
      -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    brugada_syndrome: [
      0, 0.1, 0.2, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0, -0.4, -0.2, 0, 0, 0.1, 0.2, 0.3, 0.2,
      0.1, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0, -0.4, -0.2, 0,
    ],
    hypokalemia: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.3, -0.4, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1,
      0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.3, -0.4, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    hyperkalemia: [
      0, 0.1, 0.2, 0.3, 0.4, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.3,
      0.4, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    hypocalcemia: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0.2, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1,
      0, 0, 0, 0, 0, -0.1, -0.2, -0.3, 0, 0.8, 1, 0.8, 0.4, 0.2, 0, -0.2, -0.1, 0,
    ],
    hypercalcemia: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, -0.1,
      -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    hypothermia: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, 0, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.2, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2,
      0.1, 0, 0, 0, 0, 0.2, 0.4, 0.2, 0, -0.2, -0.4, -0.2, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    pericarditis: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.1, 0.2, 0.1, 0, 0.8, 1, 0.8, 0, -0.1, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1,
      0, -0.1, -0.2, -0.1, 0, 0.1, 0.2, 0.1, 0, 0.8, 1, 0.8, 0, -0.1, -0.2, -0.1, 0,
    ],
    myocardial_ischemia: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1, 0, 0,
      0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    myocardial_infarction_anterior: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.4, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.1,
      0, -0.1, -0.2, -0.3, -0.4, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
    myocardial_infarction_inferior: [
      0, 0.1, 0.2, 0.1, 0, 0, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0, 0, 0.1, 0.2,
      0.1, 0, 0, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0,
    ],
    myocardial_infarction_lateral: [
      0, 0.1, 0.2, 0.1, 0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0, 0, 0.1, 0.2, 0.1,
      0, -0.1, -0.2, -0.3, -0.2, -0.1, 0, 0.8, 1, 0.8, 0.2, 0.1, 0, -0.1, -0.2, 0,
    ],
    pulmonary_embolism: [
      0, 0.1, 0.2, 0.3, 0.2, 0.1, 0, -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0, 0, 0.1, 0.2, 0.3, 0.2, 0.1, 0,
      -0.1, -0.2, -0.1, 0, 0.8, 1, 0.8, 0, -0.2, -0.1, 0,
    ],
  },
  spo2: {
    normal: [
      0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.9,
      0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.3, 0.4,
    ],
    low: [
      0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.7,
      0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2,
    ],
    irregular: [
      0.5, 0.7, 0.4, 0.9, 0.3, 0.8, 0.2, 0.6, 0.5, 0.7, 0.4, 0.8, 0.3, 0.6, 0.2, 0.5, 0.4, 0.8, 0.3, 0.7, 0.5, 0.9, 0.2,
      0.6, 0.4, 0.7, 0.3, 0.8, 0.2, 0.5, 0.4, 0.6,
    ],
  },
  capno: {
    normal: [
      0.0, 0.0, 0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.0, 1.0, 1.0, 0.8, 0.4, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.2, 0.4, 0.6, 0.8,
      1.0, 1.0, 1.0, 1.0, 0.8, 0.4, 0.0, 0.0, 0.0,
    ],
    obstructed: [
      0.0, 0.0, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.5, 0.5, 0.5, 0.4, 0.2, 0.1, 0.0, 0.0, 0.0, 0.0, 0.0, 0.1, 0.2, 0.3, 0.4,
      0.5, 0.5, 0.5, 0.5, 0.4, 0.2, 0.1, 0.0, 0.0,
    ],
    hyperventilation: [
      0.0, 0.0, 0.2, 0.5, 0.8, 1.0, 1.0, 1.0, 0.8, 0.4, 0.0, 0.0, 0.0, 0.2, 0.5, 0.8, 1.0, 1.0, 1.0, 0.8, 0.4, 0.0, 0.0,
      0.0, 0.2, 0.5, 0.8, 1.0, 1.0, 1.0, 0.8, 0.4,
    ],
    hypoventilation: [
      0.0, 0.0, 0.0, 0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.8, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.0,
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    ],
    apnea: [
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
      0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0,
    ],
    bronchospasm: [
      0.0, 0.0, 0.1, 0.3, 0.5, 0.7, 0.8, 0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.3, 0.1, 0.0, 0.0, 0.0, 0.1, 0.3, 0.5, 0.7, 0.8,
      0.9, 0.9, 0.9, 0.8, 0.7, 0.5, 0.3, 0.1, 0.0,
    ],
    cardiac_oscillation: [
      0.0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.1, 0.2,
      0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 1.0, 0.9,
    ],
    curare_cleft: [
      0.0, 0.0, 0.0, 0.2, 0.4, 0.6, 0.8, 1.0, 1.0, 0.9, 0.8, 0.7, 0.6, 0.5, 0.4, 0.3, 0.2, 0.1, 0.0, 0.0, 0.0, 0.2, 0.4,
      0.6, 0.8, 1.0, 1.0, 0.9, 0.8, 0.7, 0.6, 0.5,
    ],
  },
}

class WaveformRenderer {
  constructor(canvasId, color, data, speed = 1) {
    this.canvas = document.getElementById(canvasId)
    this.ctx = this.canvas.getContext("2d")
    this.color = color
    this.data = data
    this.position = 0
    this.speed = speed

    this.setupCanvas()
  }

  setupCanvas() {
    const dpr = window.devicePixelRatio || 1
    const rect = this.canvas.getBoundingClientRect()

    this.canvas.width = rect.width * dpr
    this.canvas.height = rect.height * dpr

    this.ctx.scale(dpr, dpr)
    this.ctx.strokeStyle = this.color
    this.ctx.lineWidth = 2
  }

  draw() {
    this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height)
    this.drawGrid()

    this.ctx.beginPath()
    this.ctx.strokeStyle = this.color

    const dataPoints = Math.floor(this.canvas.width / this.speed)

    for (let i = 0; i < dataPoints; i++) {
      const x = i * this.speed
      const dataIndex = (i + this.position) % this.data.length
      const y = (1 - this.data[dataIndex]) * (this.canvas.height * 0.8) + this.canvas.height * 0.1

      if (i === 0) {
        this.ctx.moveTo(x, y)
      } else {
        this.ctx.lineTo(x, y)
      }
    }

    this.ctx.stroke()
  }

  drawGrid() {
    this.ctx.strokeStyle = "#2a2a2a"
    this.ctx.lineWidth = 0.5

    for (let x = 0; x < this.canvas.width; x += 20) {
      this.ctx.beginPath()
      this.ctx.moveTo(x, 0)
      this.ctx.lineTo(x, this.canvas.height)
      this.ctx.stroke()
    }

    for (let y = 0; y < this.canvas.height; y += 20) {
      this.ctx.beginPath()
      this.ctx.moveTo(0, y)
      this.ctx.lineTo(this.canvas.width, y)
      this.ctx.stroke()
    }

    this.ctx.lineWidth = 2
  }

  animate() {
    requestAnimationFrame(() => this.animate())
    this.position = (this.position + this.speed) % this.data.length
    this.draw()
  }

  setSpeed(speed) {
    this.speed = speed
  }
}

// Export for use in script.js
window.WaveformRenderer = WaveformRenderer
window.waveformData = waveformData

